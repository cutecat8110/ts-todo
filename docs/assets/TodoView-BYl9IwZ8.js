import{H as F,d as j,u as ae,a as le,c as w,r as re,o as f,b as L,e as d,w as B,f as a,g as h,h as ie,T as ce,i as ue,_ as R,j as M,k as de,l as pe,m as N,n as fe,p as n,q as ve,s as me,t as _e,v as ge,x as $,y as U,z as he,A as T,B as be,C as q,D as H,E as xe,F as ye,G as z,I as Te,J as ke,K as Ce,L as C}from"./index-C2eCa2XO.js";import{_ as K}from"./UIButton.vue_vue_type_script_setup_true_lang-aKJXdBnc.js";function we(s){return F.get("/todos",s)}function Fe(s){return F.post("/todos",s)}function $e(s){return F.put("/todos/{id}",s)}function Ie(s){return F.delete("/todos/{id}",s)}function Se(s){return F.patch("/todos/{id}/toggle",s)}const ze=j({__name:"UIScrollTop",setup(s){const{height:m}=ae(),{y:v}=le({behavior:"smooth"}),i=()=>{v.value=0},b=w(()=>v.value>m.value/2);return(p,t)=>{const r=re("Icon");return f(),L(ue,{to:"#app"},[d(ce,{name:"scroll-top"},{default:B(()=>[a(b)?(f(),h("div",{key:0,class:"fixed bottom-10 right-10 z-10 flex h-14 w-14 cursor-pointer items-center justify-center rounded-full bg-black/20 text-[2.163rem] text-white transition-all hover:bg-black/40 hover:shadow",onClick:t[0]||(t[0]=c=>i())},[d(r,{icon:"ic:round-vertical-align-top"})])):ie("",!0)]),_:1})])}}}),Ee=R(ze,[["__scopeId","data-v-f9930b61"]]),Y=s=>(me("data-v-be481d68"),s=s(),_e(),s),Be={class:"my-bg flex min-h-screen flex-col"},je={class:"sticky top-0 z-10 border-b bg-white/90 backdrop-blur-sm"},Re={class:"container flex h-16 items-center justify-between gap-6 overflow-hidden text-nowrap text-4xl"},Ve=Y(()=>n("h1",{class:"select-none font-bold tracking-widest text-blue-600"},"TS Todo",-1)),Ae=Y(()=>n("footer",{class:"border-t bg-white"},[n("div",{class:"container flex h-14 items-center justify-center"},[n("h6",{class:"text-sm font-bold text-gray-600"},"Copyright © 2024 by Hao")])],-1)),De=j({__name:"LayoutDefault",setup(s){var r,c;const m=M(),v=de(),i=pe(),b=(c=(r=N())==null?void 0:r.proxy)==null?void 0:c.$Swal,{isFetching:p,execute:t}=fe({afterFetch({data:x}){return m.auth={token:"",nickname:""},i.push({name:"login"}),{data:x}},onFetchError({data:x}){return b==null||b.fire({title:"驗證失敗",text:"請重新登入",icon:"warning",confirmButtonText:"確認",confirmButtonColor:v.confirmButtonColor,allowOutsideClick:!1,willClose:()=>{m.auth={token:"",nickname:""},i.push({name:"login"})}}),x}});return(x,V)=>{const I=K,_=Ee;return f(),h("div",Be,[n("header",je,[n("div",Re,[Ve,d(I,{label:"登出",color:"blue",icon:"ic:baseline-logout",size:"lg",trailing:"",variant:"link",disabled:a(p),onClick:a(t)},null,8,["disabled","onClick"])])]),ve(x.$slots,"default",{},void 0,!0),Ae,d(_)])}}}),Pe=R(De,[["__scopeId","data-v-be481d68"]]);function E(s,m){return s.replace(/{(.*?)}/g,(v,i)=>m[i])}const Ue={class:"flex-1 py-10"},qe={class:"container space-y-4 lg:max-w-[50rem]"},He={class:"text-2xl font-black"},Le={class:"space-y-6 rounded-xl bg-gray-100 p-6"},Me={class:"flex items-center justify-between font-black text-gray-600"},Ne={class:"flex gap-2 text-[2.5rem] leading-none"},Ke={class:"text-sm"},Ye={class:"text-end text-gray-400"},Ge={class:"text-2xl text-gray-600"},We={class:"flex space-x-4"},Je=["disabled"],Oe=["onClick"],Qe={key:0,class:"overflow-hidden text-ellipsis"},Xe=["onUpdate:modelValue","disabled"],Ze={class:"ml-auto flex shrink-0 gap-2 pl-2"},et=j({__name:"TodoView",setup(s){var D,P;const m=M(),v=(P=(D=N())==null?void 0:D.proxy)==null?void 0:P.$dayjs,i=ge(),b=w(()=>{const e=v==null?void 0:v(i.value).hour();return e===void 0?"":e<4?"午夜好":e<12?"早上好":e<18?"下午好":e<21?"傍晚好":"晚上好"}),p=w(()=>J.value||x.value||Q.value||ee.value||ne.value),t=$([]),r=$({}),c=$(-1),{isFetching:x,execute:V}=we({immediate:!0,afterFetch({data:e}){return t.value=e.data.map(l=>({editTodoRefs:null,autosize:null,tempContent:"",edit:!1,...l})).reverse(),{data:e}}}),{textarea:I,input:_}=U({input:$("")}),G=()=>{if(_.value!=="")return A()},W=e=>{if(e.ctrlKey&&e.key==="Enter")return A()},{isFetching:J,execute:A}=Fe({afterFetch({data:e}){return _.value="",V(),{data:e}}}).post(w(()=>({content:_.value}))),O=async(e,l)=>{r.value=e,c.value=l,X()},{isFetching:Q,execute:X}=Ie({beforeFetch({url:e}){return{url:E(e,{id:r.value.id})}},afterFetch({data:e}){return t.value=t.value.filter((l,u)=>u!==c.value),{data:e}}}),Z=(e,l)=>{r.value=e,c.value=l,te()},{isFetching:ee,execute:te}=Se({beforeFetch({url:e}){return{url:E(e,{id:r.value.id})}},afterFetch({data:e}){return t.value[c.value].status=!r.value.status,{data:e}}}),S=e=>{t.value[e].tempContent=t.value[e].content,t.value[e].edit=!t.value[e].edit,t.value[e].edit&&ke(()=>{t.value[e].editTodoRefs.focus()})};he(()=>t.value.map(e=>e.editTodoRefs),(e,l)=>{e.forEach((u,y)=>{const o=l[y]??null;t.value[y].autosize=u!==o?u!==null?U({element:t.value[y].editTodoRefs,input:t.value[y].tempContent}):null:t.value[y].autosize})},{deep:!0});const oe=(e,l)=>{r.value=e,c.value=l,se()},{isFetching:ne,execute:se}=$e({beforeFetch({url:e}){return{url:E(e,{id:r.value.id})}},afterFetch({data:e}){return t.value[c.value].content=r.value.tempContent,S(c.value),{data:e}}}).post(w(()=>({content:r.value.tempContent})));return(e,l)=>{const u=K,y=Pe;return f(),L(y,null,{default:B(()=>[n("main",Ue,[n("div",qe,[n("div",He,T(a(b))+"，"+T(a(m).auth.nickname)+"，歡迎回來👋 ",1),n("div",Le,[n("div",Me,[n("div",Ne,[be(T(e.$dayjs(a(i)).format("DD"))+" ",1),n("div",Ke,[n("div",null,T(e.$dayjs(a(i)).format("MMM YYYY")),1),n("div",Ye,T(e.$dayjs(a(i)).format("HH:mm:ss")),1)])]),n("div",Ge,T(e.$dayjs(a(i)).format("dddd")),1)]),n("div",We,[q(n("textarea",{ref_key:"addTodoRefs",ref:I,"onUpdate:modelValue":l[0]||(l[0]=o=>xe(_)?_.value=o:null),class:"flex-1 resize-none rounded-md px-4 py-2 outline-none ring-1 ring-inset ring-gray-300 focus:ring-blue-600",placeholder:"Todo",disabled:a(p),onKeydown:W},null,40,Je),[[H,a(_),void 0,{trim:!0}]]),d(u,{label:"新增",color:"blue",size:"lg",disabled:a(p),onClick:l[1]||(l[1]=o=>G())},null,8,["disabled"])])]),d(Te,{class:"relative space-y-4",name:"todo-list",tag:"ul"},{default:B(()=>[(f(!0),h(z,null,ye(a(t),(o,k)=>(f(),h("li",{key:o.id,class:Ce([o.status&&!o.edit&&"line-through",o.status?"border-transparent bg-gray-100 text-gray-500 ":"bg-white","flex w-full items-center rounded-xl border-2  p-[0.625rem] px-4 font-black transition-all hover:border-gray-300 hover:shadow "]),onClick:g=>!o.edit&&Z(o,k)},[d(u,{class:"pointer-events-none shrink-0",color:o.status?"blue":void 0,icon:o.status?"ic:round-radio-button-checked":"ic:outline-circle",size:"lg",square:"",variant:"text"},null,8,["color","icon"]),o.edit?q((f(),h("textarea",{key:1,ref_for:!0,ref:g=>o.editTodoRefs=g,"onUpdate:modelValue":g=>o.tempContent=g,class:"flex-1 resize-none rounded-md px-4 py-2 outline-none ring-1 ring-inset ring-gray-300 focus:ring-blue-600",placeholder:"Todo",disabled:a(p),onClick:l[2]||(l[2]=C(()=>{},["stop"]))},null,8,Xe)),[[H,o.tempContent,void 0,{trim:!0}]]):(f(),h("div",Qe,T(o.content),1)),n("div",Ze,[o.edit?(f(),h(z,{key:1},[d(u,{color:"lightGray",icon:"ic:round-close",square:"",variant:"text",disabled:a(p),onClick:C(g=>S(k),["stop"])},null,8,["disabled","onClick"]),d(u,{color:"green",icon:"ic:round-done",square:"",variant:"text",disabled:a(p),onClick:C(g=>oe(o,k),["stop"])},null,8,["disabled","onClick"])],64)):(f(),h(z,{key:0},[d(u,{icon:"ic:round-mode-edit-outline",square:"",variant:"text",disabled:a(p),onClick:C(g=>S(k),["stop"])},null,8,["disabled","onClick"]),d(u,{icon:"ic:baseline-delete",square:"",variant:"text",disabled:a(p),onClick:C(g=>O(o,k),["stop"])},null,8,["disabled","onClick"])],64))])],10,Oe))),128))]),_:1})])])]),_:1})}}}),nt=R(et,[["__scopeId","data-v-4cff9534"]]);export{nt as default};
