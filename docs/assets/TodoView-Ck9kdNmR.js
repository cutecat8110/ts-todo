import{H as w,d as O,u as J,a as Q,b as re,c as le,g as W,l as ie,o as f,e as h,f as n,h as _,i as t,r as ue,_ as X,p as ce,j as de,k as Z,m as fe,n as z,q as k,s as N,t as ge,w as U,v as L,x as v,y as me,z as Y,A as G,B as pe,C as j,D,E as ve,F as he,G as V,T as _e}from"./index-DZvZe3qW.js";function be(r){return w.get("/todos",r)}function ye(r){return w.post("/todos",r)}function xe(r){return w.put("/todos/{id}",r)}function Te(r){return w.delete("/todos/{id}",r)}function ke(r){return w.patch("/todos/{id}/toggle",r)}const ee=r=>(ce("data-v-dd4c3601"),r=r(),de(),r),we={class:"my-bg flex min-h-screen flex-col"},Ce={class:"sticky top-0 z-10 border-b bg-white/90 backdrop-blur-sm"},Fe={class:"container flex h-16 items-center justify-between gap-6 overflow-hidden text-nowrap text-4xl"},$e=ee(()=>n("h1",{class:"select-none font-bold tracking-widest text-blue-600"},"TS Todo",-1)),Se=ee(()=>n("footer",{class:"border-t bg-white"},[n("div",{class:"container flex h-14 items-center justify-center"},[n("h6",{class:"text-sm font-bold text-gray-600"},"Copyright © 2024 by Hao")])],-1)),Ie=O({__name:"LayoutDefault",setup(r){var d,i;const x=J(),b=Q(),y=re(),g=le(),T=(i=(d=W())==null?void 0:d.proxy)==null?void 0:i.$Swal,{isFetching:o,execute:C}=ie({afterFetch({data:m}){return x.auth={token:"",nickname:""},g.push({name:"login"}),b.info({message:`${m.message}.`}),{data:m}},onFetchError({data:m}){return T==null||T.fire({title:"驗證失敗",text:"請重新登入",icon:"warning",confirmButtonText:"確認",confirmButtonColor:y.confirmButtonColor,allowOutsideClick:!1,willClose:()=>{x.auth={token:"",nickname:""},g.push({name:"login"})}}),m}});return(m,F)=>{const p=X;return f(),h("div",we,[n("header",Ce,[n("div",Fe,[$e,_(p,{label:"登出",color:"blue",icon:"ic:baseline-logout",size:"lg",trailing:"",variant:"link",disabled:t(o),onClick:t(C)},null,8,["disabled","onClick"])])]),ue(m.$slots,"default",{},void 0,!0),Se])}}}),ze=Z(Ie,[["__scopeId","data-v-dd4c3601"]]);function A(r,x){return r.replace(/{(.*?)}/g,(b,y)=>x[y])}const Ee={class:"flex-1 py-10"},Re={class:"container lg:max-w-[50rem]"},Be={class:"text-2xl font-black"},je={class:"mt-4 space-y-6 rounded-xl bg-gray-100 p-6"},De={class:"flex flex-wrap items-center justify-between font-black text-gray-600"},Ve={class:"flex flex-wrap gap-2 text-[2.5rem] leading-none"},Ae={class:"text-sm"},Pe={class:"text-end text-gray-400"},qe={class:"text-2xl text-gray-600"},He={class:"flex flex-wrap gap-x-4 gap-y-2"},Ke=["disabled"],Me={key:0,class:"w-full text-red-600"},Ne={class:"relative mt-4 h-6 overflow-hidden rounded-full bg-gray-300 text-sm font-black tracking-wide text-white"},Ue={class:"absolute inset-0 flex items-center justify-center"},Le=["onUpdate:modelValue","readonly","disabled","onKeydown"],Ye={class:"ml-auto flex shrink-0 gap-2 pl-2"},Ge={key:0,class:"ml-10 w-full text-red-600"},Oe=O({__name:"TodoView",setup(r){var K,M;const x=J(),b=Q(),y=(M=(K=W())==null?void 0:K.proxy)==null?void 0:M.$dayjs,g=fe(),T=z(()=>{const e=y==null?void 0:y(g.value).hour();return e===void 0?"":e<4?"午夜好":e<12?"早上好":e<18?"下午好":e<21?"傍晚好":"晚上好"}),o=k([]),C=z(()=>o.value.filter(e=>e.status==!0).length),d=k({}),i=k(-1),{execute:m}=be({immediate:!0,afterFetch({data:e}){return o.value=e.data.map(a=>({editTodoRefs:null,todoRefs:null,autosize:null,tempContent:a.content,edit:!1,error:!1,...a})).reverse(),L(()=>{o.value.forEach((a,l)=>{o.value[l].autosize=N({element:o.value[l].editTodoRefs,input:o.value[l].tempContent})}),F.value.focus()}),{data:e}}}),{textarea:F,input:p}=N({input:k("")}),$=k(!1),te=()=>{if(p.value==""){$.value=!0,F.value.focus();return}H()},P=(e,a,l)=>{if(a==-1?$.value=!1:o.value[a].error=!1,e.ctrlKey&&e.key==="Enter")return l()},{isFetching:q,execute:H}=ye({afterFetch({data:e}){return p.value="",b.success({message:"Todo 已新增."}),m(),{data:e}}}).post(z(()=>({content:p.value}))),S=(e,a,l)=>{switch(d.value=e,i.value=a,l){case"delete":oe();break;case"toggle":se();break;case"update":if(o.value[a].tempContent==""){o.value[a].error=!0,o.value[a].editTodoRefs.focus();return}ne();break}},{isFetching:E,execute:oe}=Te({beforeFetch({url:e}){return{url:A(e,{id:d.value.id})}},afterFetch({data:e}){return o.value=o.value.filter((a,l)=>l!==i.value),b.warn({message:"Todo 已刪除."}),{data:e}}}),{isFetching:R,execute:se}=ke({beforeFetch({url:e}){return{url:A(e,{id:d.value.id})}},afterFetch({data:e}){return o.value[i.value].status=!d.value.status,b.success({message:"Todo 狀態更新."}),{data:e}}}),B=e=>{o.value[e].edit=!o.value[e].edit,o.value[e].error=!1,o.value[e].edit?L(()=>{o.value[e].editTodoRefs.focus()}):(o.value[e].autosize.triggerResize(),o.value[e].tempContent=o.value[e].content)},{isFetching:I,execute:ne}=xe({beforeFetch({url:e}){return{url:A(e,{id:d.value.id})}},afterFetch({data:e}){return o.value[i.value].content=d.value.tempContent,b.info({message:`Todo ${e.message}.`}),B(i.value),{data:e}}}).post(z(()=>({content:d.value.tempContent})));return(e,a)=>{const l=X,ae=ze;return f(),ge(ae,null,{default:U(()=>[n("main",Ee,[n("div",Re,[n("div",Be,v(t(T))+"，"+v(t(x).auth.nickname)+"，歡迎回來👋 ",1),n("div",je,[n("div",De,[n("div",Ve,[me(v(e.$dayjs(t(g)).format("DD"))+" ",1),n("div",Ae,[n("div",null,v(e.$dayjs(t(g)).format("MMM YYYY")),1),n("div",Pe,v(e.$dayjs(t(g)).format("HH:mm:ss")),1)])]),n("div",qe,v(e.$dayjs(t(g)).format("dddd")),1)]),n("div",He,[Y(n("textarea",{ref_key:"addTodoRefs",ref:F,"onUpdate:modelValue":a[0]||(a[0]=s=>pe(p)?p.value=s:null),class:j([t($)?"ring-red-600":"ring-gray-300 focus:ring-blue-600 ","flex-1 resize-none rounded-md px-4 py-2 outline-none ring-1 ring-inset"]),placeholder:"Todo",disabled:t(q),onKeydown:a[1]||(a[1]=s=>P(s,-1,()=>t(H)()))},null,42,Ke),[[G,t(p),void 0,{trim:!0}]]),_(l,{label:"新增",color:"blue",size:"lg",disabled:t(q),onClick:a[2]||(a[2]=s=>te())},null,8,["disabled"]),t($)?(f(),h("div",Me,"Todo 為必填")):D("",!0)])]),n("div",Ne,[t(o).length!==0?(f(),h("div",{key:0,class:"progress-bar h-full bg-red-800 text-center",style:ve({width:t(C)/t(o).length*100+"%"})},null,4)):D("",!0),n("span",Ue,v(t(C))+" / "+v(t(o).length)+" Todo 完成 ",1)]),_(_e,{class:"relative mt-4 space-y-4",name:"todo-list",tag:"ul"},{default:U(()=>[(f(!0),h(V,null,he(t(o),(s,u)=>(f(),h("li",{ref_for:!0,ref:c=>s.todoRefs=c,key:s.id,class:j([s.status&&!s.edit&&"line-through",s.status?"border-transparent bg-gray-100 text-gray-500":"bg-white","flex w-full flex-wrap items-center gap-y-2 overflow-hidden rounded-xl border-2 p-[0.625rem] px-4 font-black transition-all hover:border-gray-300 hover:shadow"])},[_(l,{class:"shrink-0",color:s.status?"blue":void 0,icon:s.status?"ic:round-radio-button-checked":"ic:outline-circle",size:"lg",square:"",variant:"text",disabled:t(i)==u&&(t(I)||t(E)||t(R)),onClick:c=>!s.edit&&S(s,u,"toggle")},null,8,["color","icon","disabled","onClick"]),Y(n("textarea",{ref_for:!0,ref:c=>s.editTodoRefs=c,"onUpdate:modelValue":c=>s.tempContent=c,class:j([s.edit?"bg-white ring-1 ring-inset ":"cursor-default",s.edit&&s.error?"ring-red-600":"ring-gray-300 focus:ring-blue-600","flex-1 resize-none rounded-md bg-transparent px-4 py-2 outline-none"]),placeholder:"Todo",readonly:!s.edit,disabled:t(i)==u&&t(I),onKeydown:c=>P(c,u,()=>S(s,u,"update"))},null,42,Le),[[G,s.tempContent,void 0,{trim:!0}]]),n("div",Ye,[s.edit?(f(),h(V,{key:1},[_(l,{color:"lightGray",icon:"ic:round-close",square:"",variant:"text",disabled:t(i)==u&&t(I),onClick:c=>B(u)},null,8,["disabled","onClick"]),_(l,{color:"blue",icon:"ic:round-done",square:"",variant:"text",disabled:t(i)==u&&t(I),onClick:c=>S(s,u,"update")},null,8,["disabled","onClick"])],64)):(f(),h(V,{key:0},[_(l,{icon:"ic:round-mode-edit-outline",square:"",variant:"text",disabled:t(i)==u&&(t(E)||t(R)),onClick:c=>B(u)},null,8,["disabled","onClick"]),_(l,{icon:"ic:baseline-delete",square:"",variant:"text",disabled:t(i)==u&&(t(E)||t(R)),onClick:c=>S(s,u,"delete")},null,8,["disabled","onClick"])],64))]),s.error?(f(),h("div",Ge,"Todo 為必填")):D("",!0)],2))),128))]),_:1})])])]),_:1})}}}),Qe=Z(Oe,[["__scopeId","data-v-c6903c7c"]]);export{Qe as default};
