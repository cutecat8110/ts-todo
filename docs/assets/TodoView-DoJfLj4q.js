import{_ as ae}from"./PageCopyright-CSTwpMKX.js";import{H as C,d as O,u as J,a as Q,b as re,c as le,g as W,l as ie,o as f,e as _,f as n,h as g,i as t,r as ue,_ as X,p as de,j as ce,k as Z,m as fe,n as z,q as w,s as N,t as ge,w as U,v as L,x as h,y as me,z as Y,A as G,B as pe,C as D,D as P,E as ve,F as he,G as V,T as _e}from"./index-DWb1hAVM.js";function be(r){return C.get("/todos",r)}function ye(r){return C.post("/todos",r)}function Te(r){return C.put("/todos/{id}",r)}function xe(r){return C.delete("/todos/{id}",r)}function ke(r){return C.patch("/todos/{id}/toggle",r)}const we=r=>(de("data-v-f6a8b3c4"),r=r(),ce(),r),Ce={class:"layout-default"},Fe={class:"sticky top-0 z-10 border-b bg-white/90 backdrop-blur-sm"},$e={class:"container flex h-16 items-center justify-between gap-6 overflow-hidden text-nowrap text-4xl"},Se=we(()=>n("h1",{class:"select-none font-bold tracking-widest text-blue-600"},"TS Todo",-1)),Ie={class:"border-t bg-white"},ze=O({__name:"LayoutDefault",setup(r){var c,i;const T=J(),b=Q(),y=re(),m=le(),k=(i=(c=W())==null?void 0:c.proxy)==null?void 0:i.$Swal,{isFetching:o,execute:F}=ie({afterFetch({data:p}){return T.auth={token:"",nickname:""},m.push({name:"login"}),b.info({message:`${p.message}.`}),{data:p}},onFetchError({data:p}){return k==null||k.fire({title:"驗證失敗",text:"請重新登入",icon:"warning",confirmButtonText:"確認",confirmButtonColor:y.confirmButtonColor,allowOutsideClick:!1,willClose:()=>{T.auth={token:"",nickname:""},m.push({name:"login"})}}),p}});return(p,$)=>{const v=X,x=ae;return f(),_("div",Ce,[n("header",Fe,[n("div",$e,[Se,g(v,{label:"登出",color:"blue",icon:"ic:baseline-logout",size:"lg",trailing:"",variant:"link",disabled:t(o),onClick:t(F)},null,8,["disabled","onClick"])])]),ue(p.$slots,"default",{},void 0,!0),n("footer",Ie,[g(x,{class:"container h-14"})])])}}}),Ee=Z(ze,[["__scopeId","data-v-f6a8b3c4"]]);function j(r,T){return r.replace(/{(.*?)}/g,(b,y)=>T[y])}const Re={class:"todo-view"},Be={class:"container lg:max-w-[50rem]"},De={class:"text-2xl font-bold"},Pe={class:"mt-4 space-y-6 rounded-xl bg-gray-100 p-6"},Ve={class:"flex flex-wrap items-center justify-between font-bold text-gray-600"},je={class:"flex flex-wrap gap-2 text-[2.5rem] leading-none"},Ae={class:"text-sm"},qe={class:"text-end text-gray-400"},He={class:"text-2xl text-gray-600"},Ke={class:"flex flex-wrap gap-x-4 gap-y-2"},Me=["disabled"],Ne={key:0,class:"w-full text-red-600"},Ue={class:"relative mt-4 h-6 overflow-hidden rounded-full bg-gray-300 text-sm font-bold tracking-wide text-white"},Le={class:"absolute inset-0 flex items-center justify-center"},Ye=["onUpdate:modelValue","readonly","disabled","onKeydown"],Ge={class:"ml-auto flex shrink-0 gap-2 pl-2"},Oe={key:0,class:"ml-10 w-full text-red-600"},Je=O({__name:"TodoView",setup(r){var K,M;const T=J(),b=Q(),y=(M=(K=W())==null?void 0:K.proxy)==null?void 0:M.$dayjs,m=fe(),k=z(()=>{const e=y==null?void 0:y(m.value).hour();return e===void 0?"":e<4?"午夜好":e<12?"早上好":e<18?"下午好":e<21?"傍晚好":"晚上好"}),o=w([]),F=z(()=>o.value.filter(e=>e.status==!0).length),c=w({}),i=w(-1),{execute:p}=be({immediate:!0,afterFetch({data:e}){return o.value=e.data.map(a=>({editTodoRefs:null,todoRefs:null,autosize:null,tempContent:a.content,edit:!1,error:!1,...a})).reverse(),L(()=>{o.value.forEach((a,l)=>{o.value[l].autosize=N({element:o.value[l].editTodoRefs,input:o.value[l].tempContent})}),$.value.focus()}),{data:e}}}),{textarea:$,input:v}=N({input:w("")}),x=w(!1),ee=()=>{if(v.value==""){x.value=!0,$.value.focus();return}H()},A=(e,a,l)=>{if(a==-1?x.value=!1:o.value[a].error=!1,e.ctrlKey&&e.key==="Enter")return l()},{isFetching:q,execute:H}=ye({afterFetch({data:e}){return v.value="",b.success({message:"Todo 已新增."}),p(),{data:e}}}).post(z(()=>({content:v.value}))),S=(e,a,l)=>{switch(c.value=e,i.value=a,l){case"delete":te();break;case"toggle":oe();break;case"update":if(o.value[a].tempContent==""){o.value[a].error=!0,o.value[a].editTodoRefs.focus();return}se();break}},{isFetching:E,execute:te}=xe({beforeFetch({url:e}){return{url:j(e,{id:c.value.id})}},afterFetch({data:e}){return o.value=o.value.filter((a,l)=>l!==i.value),b.warn({message:"Todo 已刪除."}),{data:e}}}),{isFetching:R,execute:oe}=ke({beforeFetch({url:e}){return{url:j(e,{id:c.value.id})}},afterFetch({data:e}){return o.value[i.value].status=!c.value.status,b.success({message:"Todo 狀態更新."}),{data:e}}}),B=e=>{o.value[e].edit=!o.value[e].edit,o.value[e].error=!1,o.value[e].edit?L(()=>{o.value[e].editTodoRefs.focus()}):(o.value[e].autosize.triggerResize(),o.value[e].tempContent=o.value[e].content)},{isFetching:I,execute:se}=Te({beforeFetch({url:e}){return{url:j(e,{id:c.value.id})}},afterFetch({data:e}){return o.value[i.value].content=c.value.tempContent,b.info({message:`Todo ${e.message}.`}),B(i.value),{data:e}}}).post(z(()=>({content:c.value.tempContent})));return(e,a)=>{const l=X,ne=Ee;return f(),ge(ne,null,{default:U(()=>[n("main",Re,[n("div",Be,[n("div",De,h(t(k))+"，"+h(t(T).auth.nickname)+"，歡迎回來👋 ",1),n("div",Pe,[n("div",Ve,[n("div",je,[me(h(e.$dayjs(t(m)).format("DD"))+" ",1),n("div",Ae,[n("div",null,h(e.$dayjs(t(m)).format("MMM YYYY")),1),n("div",qe,h(e.$dayjs(t(m)).format("HH:mm:ss")),1)])]),n("div",He,h(e.$dayjs(t(m)).format("dddd")),1)]),n("div",Ke,[Y(n("textarea",{ref_key:"addTodoRefs",ref:$,"onUpdate:modelValue":a[0]||(a[0]=s=>pe(v)?v.value=s:null),class:D([t(x)?"ring-red-600":"ring-gray-300 focus:ring-blue-600 ","flex-1 resize-none rounded-md px-4 py-2 outline-none ring-1 ring-inset"]),placeholder:"Todo",disabled:t(q),onKeydown:a[1]||(a[1]=s=>A(s,-1,()=>t(H)()))},null,42,Me),[[G,t(v),void 0,{trim:!0}]]),g(l,{label:"新增",color:"blue",size:"lg",disabled:t(q),onClick:a[2]||(a[2]=s=>ee())},null,8,["disabled"]),t(x)?(f(),_("div",Ne,"Todo 為必填")):P("",!0)])]),n("div",Ue,[t(o).length!==0?(f(),_("div",{key:0,class:"progress-bar h-full bg-red-800 text-center",style:ve({width:t(F)/t(o).length*100+"%"})},null,4)):P("",!0),n("span",Le,h(t(F))+" / "+h(t(o).length)+" Todo 完成 ",1)]),g(_e,{class:"relative mt-4 space-y-4",name:"todo-list",tag:"ul"},{default:U(()=>[(f(!0),_(V,null,he(t(o),(s,u)=>(f(),_("li",{ref_for:!0,ref:d=>s.todoRefs=d,key:s.id,class:D([s.status&&!s.edit&&"line-through",s.status?"border-transparent bg-gray-100 text-gray-500":"bg-white","flex w-full flex-wrap items-center gap-y-2 overflow-hidden rounded-xl border-2 p-[0.625rem] px-4  transition-all hover:border-gray-300 hover:shadow"])},[g(l,{class:"shrink-0",color:s.status?"blue":void 0,icon:s.status?"ic:round-radio-button-checked":"ic:outline-circle",size:"lg",square:"",variant:"text",disabled:t(i)==u&&(t(I)||t(E)||t(R)),onClick:d=>!s.edit&&S(s,u,"toggle")},null,8,["color","icon","disabled","onClick"]),Y(n("textarea",{ref_for:!0,ref:d=>s.editTodoRefs=d,"onUpdate:modelValue":d=>s.tempContent=d,class:D([s.edit?"bg-white ring-1 ring-inset ":"cursor-default",s.edit&&s.error?"ring-red-600":"ring-gray-300 focus:ring-blue-600","flex-1 resize-none rounded-md bg-transparent px-4 py-2 outline-none"]),placeholder:"Todo",readonly:!s.edit,disabled:t(i)==u&&t(I),onKeydown:d=>A(d,u,()=>S(s,u,"update"))},null,42,Ye),[[G,s.tempContent,void 0,{trim:!0}]]),n("div",Ge,[s.edit?(f(),_(V,{key:1},[g(l,{color:"lightGray",icon:"ic:round-close",square:"",variant:"text",disabled:t(i)==u&&t(I),onClick:d=>B(u)},null,8,["disabled","onClick"]),g(l,{color:"blue",icon:"ic:round-done",square:"",variant:"text",disabled:t(i)==u&&t(I),onClick:d=>S(s,u,"update")},null,8,["disabled","onClick"])],64)):(f(),_(V,{key:0},[g(l,{icon:"ic:round-mode-edit-outline",square:"",variant:"text",disabled:t(i)==u&&(t(E)||t(R)),onClick:d=>B(u)},null,8,["disabled","onClick"]),g(l,{icon:"ic:baseline-delete",square:"",variant:"text",disabled:t(i)==u&&(t(E)||t(R)),onClick:d=>S(s,u,"delete")},null,8,["disabled","onClick"])],64))]),s.error?(f(),_("div",Oe,"Todo 為必填")):P("",!0)],2))),128))]),_:1})])])]),_:1})}}}),Xe=Z(Je,[["__scopeId","data-v-b364b657"]]);export{Xe as default};
